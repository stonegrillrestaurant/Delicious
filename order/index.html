<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stone Grill - Online Order</title>
  <meta name="description" content="Order food online from Stone Grill Restaurant.">
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; background: #fff; color: #222; margin: 0; padding: 20px; }
    .container { max-width: 700px; margin: 0 auto; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #fefefe; }
    h1, h3 { color: #b22222; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; border-radius: 4px; border: 1px solid #ccc; }
    textarea { resize: vertical; }
    button { background: #b22222; color: #fff; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #951a1a; }

    .section-box { background: #fff; border: 1px solid #ccc; padding: 15px; margin-top: 20px; border-radius: 6px; }
    .cart-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid #eee; }
    .cart-left { display: flex; align-items: center; gap: 10px; }
    .delete-btn { background: #b22222; color: white; border: none; border-radius: 4px; padding: 2px 6px; cursor: pointer; }
    .cart-total { text-align: right; font-weight: bold; margin-top: 10px; }
    .hidden { display: none; }
    .error { border-color: red; }
  </style>
</head>
<body>
<div class="container">
  <h1>Stone Grill Order Form</h1>

  <div class="section-box">
    <form id="orderForm">
      <label for="name">Full Name:</label>
      <input type="text" id="name" required>

      <label for="mobile">Mobile Number:</label>
      <input type="tel" id="mobile" placeholder="e.g. +639171234567" required>

      <label for="orderType">Order Type:</label>
      <select id="orderType" required onchange="togglePersons()">
        <option value="">-- Select --</option>
        <option value="Dine-in">Dine-in</option>
        <option value="Take-out">Take-out</option>
      </select>

      <div id="personSection" style="display:none">
        <label for="persons">Number of Persons:</label>
        <input type="number" id="persons" min="1">
      </div>

      <label for="datetime">Date & Time:</label>
      <input type="datetime-local" id="datetime" required>

      <label for="requests">Special Requests:</label>
      <textarea id="requests" rows="3"></textarea>
    </form>
  </div>

  <div class="section-box">
    <label for="category">Select Menu Category:</label>
    <select id="category" onchange="renderMenu()">
      <option value="">-- Choose --</option>
      <option value="pork">Pork</option>
      <option value="chicken">Chicken</option>
      <option value="vegetable">Vegetables</option>
    </select>
    <div id="menuItems"></div>
  </div>

  <div class="section-box">
    <h3>Ordered Items:</h3>
    <div id="cart"></div>
    <div class="cart-total">Total: ‚Ç±<span id="total">0</span></div>
    <button onclick="submitOrder()">Submit Order</button>
  </div>

  <div id="confirmation" class="hidden section-box"></div>
</div>

<script>
const menuData = {
  pork: [{ name: "Pork Sisig", price: 199 }, { name: "Lechon Kawali", price: 229 }],
  chicken: [{ name: "Fried Chicken", price: 179 }, { name: "Buffalo Wings", price: 189 }],
  vegetable: [{ name: "Chopsuey", price: 159 }, { name: "Pinakbet", price: 149 }]
};

let cart = [];

function togglePersons() {
  const val = document.getElementById("orderType").value;
  document.getElementById("personSection").style.display = val === "Dine-in" ? "block" : "none";
}

function renderMenu() {
  const category = document.getElementById("category").value;
  const container = document.getElementById("menuItems");
  container.innerHTML = "";
  if (!menuData[category]) return;

  menuData[category].forEach((item, idx) => {
    const btn = document.createElement("button");
    btn.innerText = `${item.name} (‚Ç±${item.price})`;
    btn.onclick = () => addToCart(item);
    container.appendChild(btn);
  });
}

function addToCart(item) {
  const index = cart.findIndex(i => i.name === item.name);
  if (index >= 0) cart[index].qty += 1;
  else cart.push({ ...item, qty: 1 });
  renderCart();
}

function removeItem(index) {
  cart.splice(index, 1);
  renderCart();
}

function renderCart() {
  const cartDiv = document.getElementById("cart");
  cartDiv.innerHTML = "";
  let total = 0;
  cart.forEach((item, i) => {
    total += item.qty * item.price;
    const row = document.createElement("div");
    row.className = "cart-row";
    row.innerHTML = `
      <div class="cart-left">
        <button class="delete-btn" onclick="removeItem(${i})">üóëÔ∏è</button>
        <span>${item.qty} x ${item.name}</span>
      </div>
      <span>‚Ç±${item.price * item.qty}</span>
    `;
    cartDiv.appendChild(row);
  });
  document.getElementById("total").innerText = total;
}

function submitOrder() {
  const requiredFields = ["name", "mobile", "orderType", "datetime"];
  let valid = true;
  requiredFields.forEach(id => {
    const el = document.getElementById(id);
    if (!el.value.trim()) {
      el.classList.add("error");
      valid = false;
    } else {
      el.classList.remove("error");
    }
  });

  const mobile = document.getElementById("mobile").value;
  if (!mobile.startsWith("+63")) {
    alert("Please use +63 format for mobile number.");
    return;
  }

  if (!valid || cart.length === 0) {
    alert("Please complete all fields and select at least one item.");
    return;
  }

  const data = {
    name: document.getElementById("name").value,
    mobile,
    orderType: document.getElementById("orderType").value,
    persons: document.getElementById("persons").value,
    datetime: document.getElementById("datetime").value,
    requests: document.getElementById("requests").value,
    cart: cart,
    total: document.getElementById("total").innerText
  };

  fetch("https://script.google.com/macros/s/AKfycbwsMkI1XJkYdusQWVE-8KiEzd0g50aC5cPv6qC6WHiC-4eFQJ6MuCQwf7H8beNbKLWX/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: "-1002531095369",
      text: `New Order\nName: ${data.name}\nMobile: ${data.mobile}\nOrder Type: ${data.orderType}\nDateTime: ${data.datetime}\nRequests: ${data.requests}\nItems: ${JSON.stringify(data.cart)}\nTotal: ‚Ç±${data.total}`
    })
  })
  .then(r => r.json())
  .then(res => {
    if (res.ok) {
      document.getElementById("confirmation").classList.remove("hidden");
      document.getElementById("confirmation").innerHTML = `<h3>Thank you! Your order has been sent.</h3>`;
      document.getElementById("orderForm").reset();
      cart = [];
      renderCart();
    } else {
      document.getElementById("confirmation").classList.remove("hidden");
      document.getElementById("confirmation").innerHTML = `<h3 style='color:red'>Failed to send order. Please try again.</h3>`;
    }
  });
}
</script>
</body>
</html>
