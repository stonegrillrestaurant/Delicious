<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Document Basics -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Stone Grill's  — Online Reservation</title>

  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '643206718690040');
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
         src="https://www.facebook.com/tr?id=643206718690040&ev=PageView&noscript=1" />
  </noscript>
  <!-- End Meta Pixel Code -->

  <!-- Basic SEO -->
  <meta name="description" content="Order sizzling plates, fresh seafood, and Filipino favorites from Stone Grill Restaurant in Leyte. Dine-in or take-out — fast, easy, and delicious!">
  <meta name="keywords" content="Stone Grill, Stone Grill Restaurant, sizzling plates, seafood Leyte, Filipino food, online order, dine-in, take-out, Bato Leyte restaurant">
  <meta name="author" content="Stone Grill Restaurant">
  <link rel="canonical" href="https://stonegrillresto.net/order/">

  <!-- Open Graph (Facebook / Messenger) -->
  <meta property="og:title" content="Stone Grill Restaurant — Order Online">
  <meta property="og:description" content="Enjoy hot sizzling meals, seafood platters, and more — order online for dine-in or take-out at Stone Grill Restaurant, Leyte.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://stonegrillresto.net/order/">
  <meta property="og:site_name" content="Stone Grill Restaurant">
  <meta property="og:image" content="https://stonegrillresto.net/order/assets/og-order.jpg">
  <meta property="fb:app_id" content="2895055444086567">


  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Stone Grill Restaurant — Order Online">
  <meta name="twitter:description" content="Order sizzling plates, fresh seafood, and Filipino favorites from Stone Grill Restaurant.">
  <meta name="twitter:image" content="https://stonegrillresto.net/order/assets/og-order.jpg">

  <!-- Theme / Icons / CSS -->
  <meta name="theme-color" content="#8db600">
  <link rel="icon" href="assets/icons/favicon-32.png" sizes="32x32">
  <link rel="apple-touch-icon" href="assets/icons/apple-touch-180.png">
  <link rel="stylesheet" href="style.css?v=13">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Restaurant",
    "name": "Stone Grill Restaurant",
    "image": "https://stonegrillresto.net/order/assets/og-order.jpg",
    "description": "Sizzling plates, seafood, and Filipino favorites. Order online for dine-in or take-out.",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "PH"
    },
    "telephone": "+63 53 568 0539",
    "email": "stonegrill2014@gmail.com",
    "url": "https://stonegrillresto.net/",
    "sameAs": [
      "https://www.facebook.com/stonecitygrill"
    ]
  }
  </script>
    <!-- NEW: Minimal styles for payment popup -->
  <style>
    .tabbar { display:flex; gap:8px; margin:8px 0 12px; }
    .tabbar .tab { padding:8px 12px; border-radius:8px; border:1px solid #ddd; cursor:pointer; }
    .tab.active { background:#8db600; color:#fff; border-color:#8db600; }
    .pay-pane { display:none; }
    .pay-pane.active { display:block; }
    .gcash-number { font-size:1.1rem; letter-spacing:.5px; font-weight:600; }
    .qr-wrap { text-align:center; }
    .qr-wrap img { max-width:260px; width:100%; border-radius:10px; box-shadow:0 4px 14px rgba(0,0,0,.12); }
    .receipt-upload-block { margin-top:12px; padding:12px; border-radius:10px; background:rgba(0,0,0,0.04); }
    .receipt-upload-block h4 { margin:0 0 8px; font-size:1.02rem; }
    .receipt-status { margin-top:8px; font-size:.92rem; }
    .popup .meta { font-size:.9rem; color:#666; margin:6px 0 10px; }
    .popup .row-sb { display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .popup .small { font-size:.9rem; }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="app-header">
    <a href="/" class="brand" aria-label="Stone Grill home">
      <img id="logoImg" src="assets/icons/icon-192.png" alt="Stone Grill" class="logo">
      <div class="brand-text">
        <h1>Stone Grill</h1>
        <p>Enjoyable & Relaxing</p>
      </div>
    </a>

    <!-- Cart summary (stacked: label -> total -> checkout) -->
    <div class="cart-summary">
      <div class="total-label">Total</div>
      <div id="cartTotal" class="total-value">₱0</div>
      <button id="checkoutBtn" class="btn primary">Checkout</button>
    </div>
  </header>

  <!-- Main -->
  <main class="app-main">
    <!-- Menu -->
    <section class="menu-col">
      <!-- Category buttons will be built dynamically -->
      <div class="category-bar" id="categoryBar"></div>

      <!-- Product list -->
      <div id="menuList" class="menu-list"></div>
    </section>

    <!-- Cart + Form -->
    <aside class="cart-col">
      <div class="card highlight breathe">
        <h2 class="card-title">🦾 Your Order</h2>
        <div id="cartItems" class="cart-items"></div>

        <!-- Subtotal -->
        <div class="cart-totals">
          <div class="row">
            <span>Subtotal</span>
            <span id="cartSubtotal">₱0</span>
          </div>
        </div>

        <div class="cart-actions">
          <button id="clearCartBtn" class="btn ghost">Clear</button>
        </div>
      </div>

      <div class="card">
        <h2 class="card-title">👤 Customer Info</h2>
        <form id="orderForm" autocomplete="on">
          <label>Full Name
            <input type="text" id="fullName" required placeholder="Juan Dela Cruz">
          </label>

          <label>Mobile Number
            <input type="tel" id="mobileNumber" inputmode="numeric" required placeholder="+63 9XX XXX XXXX">
          </label>

          <label>Order Type</label>
          <div class="inline">
            <label>
              <input type="radio" name="orderType" value="Dine-in" required>
              <span>Dine-in</span>
            </label>
            <label>
              <input type="radio" name="orderType" value="Take-out" required>
              <span>Take-out</span>
            </label>
          </div>

          <div id="personsWrap" class="hidden">
            <label>Number of Persons
              <input type="number" id="persons" min="1" value="1">
            </label>
          </div>

          <div class="inline-2">
            <label>Date
              <input type="date" id="orderDate" required>
            </label>
            <label>Time
              <input type="time" id="orderTime" required>
            </label>
          </div>

          <label>Special Requests
            <textarea id="specialRequests" rows="3" placeholder="Less spicy, extra rice, no peanuts…"></textarea>
          </label>

          <button type="submit" class="btn primary wide">Submit Order</button>
        </form>
      </div>

      <div class="card muted">
        <p>
          💬 Need help?
          <a href="https://stonegrillresto.net/order/howto" id="howtoOrder">How to Order</a>
          or message us on Facebook / call
          <a href="tel:0535680539">053 568 0539</a>.
        </p>
      </div>
    </aside>
  </main>

  <!-- Popups -->
  <div id="categoryPopup" class="popup-backdrop hidden">
    <div class="popup">
      <button class="popup-close" aria-label="Close">×</button>
      <h3 class="popup-title">Browse Categories</h3>
      <div id="popupCategories" class="popup-grid"></div>
    </div>
  </div>

  <div id="itemPopup" class="popup-backdrop hidden">
    <div class="popup">
      <button class="popup-close" aria-label="Close">×</button>
      <div id="itemDetail"></div>
    </div>
  </div>

  <!-- How to Order Popup -->
  <div id="howToOrderPopup" class="popup-backdrop hidden" aria-hidden="true">
    <div class="popup" role="dialog" aria-modal="true" aria-labelledby="howtoTitle">
      <button class="popup-close" aria-label="Close">×</button>
      <h3 id="howtoTitle" class="popup-title">How to Order</h3>
      <ol style="padding-left:20px; margin:10px 0;">
        <li>Select a category and tap <strong>Add</strong> beside each dish.</li>
        <li>Review <strong>Your Order</strong>; adjust quantities or remove items.</li>
        <li>Fill in your details (Full Name, Mobile, Order Type).</li>
        <li>If Dine-in → enter <strong>Number of Persons</strong>.</li>
        <li>Pick your <strong>Date & Time</strong>.</li>
        <li>Click <strong>Submit Order</strong> — you’ll see a confirmation toast.</li>
      </ol>
      <p class="small" style="color:#666;">Tip: Keep your phone nearby in case we need to confirm details.</p>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>
    <!-- NEW: GCash Payment Popup -->
  <div id="paymentPopup" class="popup-backdrop hidden" aria-hidden="true">
    <div class="popup" role="dialog" aria-modal="true" aria-labelledby="payTitle">
      <button class="popup-close" aria-label="Close">×</button>

      <h3 id="payTitle" class="popup-title">Pay with GCash</h3>
      <div class="meta" id="payMeta">Order: <span id="payOrderId">—</span> • Total: <span id="payTotal">₱0</span></div>

      <!-- Tabs -->
      <div class="tabbar" role="tablist">
        <button class="tab active" id="tabQR" role="tab" aria-selected="true">QR Code</button>
        <button class="tab" id="tabNumber" role="tab" aria-selected="false">Mobile Number</button>
      </div>

      <!-- Pane: QR -->
      <div class="pay-pane active" id="paneQR">
        <div class="qr-wrap">
          <img id="gcashQrImg" src="" alt="GCash QR">
        </div>
        <p class="small" style="text-align:center; margin:10px 0 0;">
          Scan the QR with your GCash app to pay.
        </p>
      </div>

      <!-- Pane: Number -->
      <div class="pay-pane" id="paneNumber">
        <div class="row-sb">
          <div>
            <div class="small">Send to this GCash number</div>
            <div class="gcash-number" id="gcashMobileText">+63 9XX XXX XXXX</div>
            <div class="small" id="gcashAccountName" style="opacity:.85;">Account: Stone Grill Restaurant</div>
          </div>
          <button id="btnCopyNumber" class="btn">Copy</button>
        </div>
      </div>

      <!-- Receipt upload -->
      <div class="receipt-upload-block">
        <h4>Upload Payment Receipt</h4>
        <input id="gcashReceiptInput" type="file" accept="image/*" capture="environment" />
        <button id="btnSendReceipt" class="btn primary">Send Receipt to Stone Grill</button>
        <div id="receiptStatus" class="receipt-status" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="config.js?v=13"></script>
  <script src="main.js?v=13"></script>

  <!-- Service worker (optional, safe) --><!-- NEW: Payment popup + direct-to-Telegram receipt upload -->
<script>
(function () {
  // Helper: show/hide
  function show(el){ el.classList.remove('hidden'); el.setAttribute('aria-hidden','false'); }
  function hide(el){ el.classList.add('hidden'); el.setAttribute('aria-hidden','true'); }

  // Tabs
  const tabQR = document.getElementById('tabQR');
  const tabNumber = document.getElementById('tabNumber');
  const paneQR = document.getElementById('paneQR');
  const paneNumber = document.getElementById('paneNumber');
  function activate(tab, pane) {
    [tabQR, tabNumber].forEach(t => t.classList.remove('active'));
    [paneQR, paneNumber].forEach(p => p.classList.remove('active'));
    tab.classList.add('active'); pane.classList.add('active');
    tab.setAttribute('aria-selected','true');
    (tab === tabQR ? tabNumber : tabQR).setAttribute('aria-selected','false');
  }
  if (tabQR && tabNumber) {
    tabQR.addEventListener('click', () => activate(tabQR, paneQR));
    tabNumber.addEventListener('click', () => activate(tabNumber, paneNumber));
  }

  // Copy number
  const btnCopy = document.getElementById('btnCopyNumber');
  if (btnCopy) {
    btnCopy.addEventListener('click', async () => {
      const txt = document.getElementById('gcashMobileText').textContent.trim();
      try { await navigator.clipboard.writeText(txt); btnCopy.textContent = 'Copied'; setTimeout(()=>btnCopy.textContent='Copy',1200); }
      catch { alert('Copy failed. Please long-press and copy.'); }
    });
  }

  // Close button
  document.querySelectorAll('#paymentPopup .popup-close').forEach(btn => {
    btn.addEventListener('click', () => hide(document.getElementById('paymentPopup')));
  });

  // Expose a function your existing code can call after successful order
  // Call: window.showGcashPopup(orderId, totalAmount)
  window.showGcashPopup = function(orderId, totalAmount) {
    const pop = document.getElementById('paymentPopup');
    document.getElementById('payOrderId').textContent = orderId || '—';
    document.getElementById('payTotal').textContent = (typeof totalAmount === 'number' ? '₱' + totalAmount.toLocaleString() : (totalAmount || '₱0'));

    // Fill QR (from APP config)
    const qr = (window.APP && (window.APP.GCASH_QR_URL || window.APP.gcashQrUrl));
    const qrImg = document.getElementById('gcashQrImg');
    qrImg.src = qr || 'assets/placeholder-qr.png';

    // Fill Mobile number and Account name (optional APP config)
    const mobileTxt = document.getElementById('gcashMobileText');
    const acctName = document.getElementById('gcashAccountName');
    const mobile = window.APP && (window.APP.GCASH_MOBILE || window.APP.gcashMobile);
    const acct   = window.APP && (window.APP.GCASH_ACCOUNT_NAME || window.APP.gcashAccountName);
    if (mobile) mobileTxt.textContent = mobile;
    if (acct)   acctName.textContent = 'Account: ' + acct;

    // Default to QR tab on open
    activate(tabQR, paneQR);
    show(pop);

    // Keep a global for caption use
    window.currentOrderId = orderId || '';
    window.currentOrderTotal = totalAmount || '';
  };

  // === Direct-to-Telegram receipt upload ===
  const sendBtn = document.getElementById('btnSendReceipt');
  const fileInput = document.getElementById('gcashReceiptInput');
  const statusEl = document.getElementById('receiptStatus');

  function getField(id, fallback='') {
    const el = document.getElementById(id);
    return (el && el.value || fallback).toString().trim();
  }

  if (sendBtn && fileInput && statusEl) {
    sendBtn.addEventListener('click', async () => {
      if (!fileInput.files || !fileInput.files.length) {
        statusEl.textContent = 'Please select a receipt image first.';
        return;
      }
      const token = window.APP && (window.APP.TELEGRAM_BOT_TOKEN || window.APP.telegramBotToken);
      const chatId = window.APP && (window.APP.TELEGRAM_CHAT_ID || window.APP.telegramChatId);
      if (!token || !chatId) {
        statusEl.textContent = 'Bot is not configured. Please contact the restaurant.';
        return;
      }

      statusEl.textContent = 'Sending receipt…';

      const fullName = getField('fullName', 'Unknown Customer');
      const mobile   = getField('mobileNumber', 'N/A');
      const orderId  = (window.currentOrderId || 'N/A');
      const total    = (window.currentOrderTotal ? `₱${window.currentOrderTotal}` : null);

      const caption = [
        '🧾 GCash Receipt Received',
        `• Order ID: ${orderId}`,
        total ? `• Total: ${total}` : null,
        `• Name: ${fullName}`,
        `• Mobile: ${mobile}`
      ].filter(Boolean).join('\n');

      const file = fileInput.files[0];
      const isImage = /^image\//i.test(file.type);

      const formData = new FormData();
      formData.append('chat_id', chatId);
      formData.append('caption', caption);
      formData.append(isImage ? 'photo' : 'document', file);

      try {
        const res = await fetch(`https://api.telegram.org/bot${token}/${isImage ? 'sendPhoto' : 'sendDocument'}`, {
          method: 'POST',
          body: formData
        });
        if (res.ok) {
          statusEl.textContent = '✅ Receipt sent to our team. We’ll verify and update you.';
          fileInput.value = '';
        } else {
          const t = await res.text().catch(()=>'');
          console.error('Telegram error:', t);
          statusEl.textContent = '❌ Failed to send. Please try again.';
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = '❌ Error sending receipt. Check your connection and try again.';
      }
    });
  }
})();
</script>
  <script>
    if ('serviceWorker' in navigator) {
      const onGithubIo = location.hostname.endsWith('github.io');
      if (!onGithubIo) {
        navigator.serviceWorker.register('pwa/sw.js?v=13').catch(()=>{});
      }
    }
  </script>
</body>
</html>
