<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Oneness and Duality — Stone Grill Reflections</title>
  <meta name="description" content="Afascinating course through philosophy, theology, and psychology, ultimately converging on a single, profound idea of Oneness and Dualty">
  <link rel="icon" href="/IMG_0690.png">
    <meta property="og:image" content="https://stonegrillresto.net/reflections/pages/oneness-duality/oneness-duality.png">
<meta property="og:image:width" content="240">
<meta property="og:image:height" content="371">
<meta property="og:image:alt" content="A Journey from Duality to Oneness">

  <style>
    :root{
      --bg:#fff4ea; --paper:#fffaf0; --ink:#5a2a27; --muted:#7b514d;
      --accent:#d93404; --accent2:#f7b733; --rule:#fc4a1a; --radius:14px; --maxw:980px;
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#171311; --paper:#241d1a; --ink:#f3e3d9; --muted:#c7a69f; --accent:#ff6a3e; --accent2:#ffcc67; --rule:#ff6a3e; }
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{font-family: Georgia, ui-serif, serif; background:var(--bg); color:var(--ink)}
    header{
      background: linear-gradient(to right, var(--accent2), var(--rule));
      padding: 20px 16px; text-align:center;
    }
    header img{max-height:56px}
    header h1{margin:8px 0 0}
    main{max-width:var(--maxw); margin:0 auto; padding: 24px 16px 48px}
    .card{
      background:var(--paper); border:2px solid #e67e22; border-radius:var(--radius);
      overflow:hidden; display:grid; grid-template-columns: 1fr; gap:0;
    }
    .cover{width:100%; aspect-ratio: 16/9; object-fit:cover; background:#fff6e6}
    .inner{padding:18px}
    h2{margin:0 0 8px; font-size:clamp(22px,4vw,34px)}
    p{margin:8px 0; color:var(--muted)}
    .actions{margin-top:14px; display:flex; gap:10px; flex-wrap:wrap}
    .btn{background:var(--accent); color:#fff; text-decoration:none; padding:10px 14px; border-radius:10px; font-weight:700}
    .btn.secondary{background:#a94a1e}
    .back{display:inline-block; margin-top:16px; color:var(--accent); text-decoration:none; font-weight:700}
    footer{margin-top:24px; text-align:center; color:var(--muted)}
    @media (min-width:840px){
      .card{grid-template-columns: 46% 54%}
      .cover{height:100%; aspect-ratio:auto}
    }
  </style>
</head>
<body>
  <header>
    <img src="/reflections/IMG_0690.png" alt="Stone Grill Logo">
    <h1></h1>
  </header>

  <main id="readContent">
    <article class="card">
      <img class="cover" src="./IMG_0771.jpeg" alt="Oneness and Duality cover" onerror="this.src='IMG_0771.jpeg'">
      <div class="inner">
        <h2>A Journey from Duality to Oneness</h2>
        <p><em>To the ones who carry silence like prayer, and light like memory. May this remind you that every breath is a conversation with eternity.</em></p>
        <div class="actions">
          <a class="btn" href="./read.html">Read Reflection</a>
          <a class="btn secondary" href="./oneness-duality.pdf">Download PDF</a>
        </div>
        <a class="back" href="/reflections/index.html">← Back to Reflections</a>
      </div>
    </article>

    <footer>© First Edition 2025 · Ninox Antolihao</footer>
  </main>
  <!-- ===== Floating TTS Reader (drop-in) ===== -->
<style>
  /* Floating button */
  #ttsFab{
    position:fixed; right:18px; bottom:18px; z-index:9999;
    width:52px; height:52px; border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    background:var(--accent, #ff6a3d); color:#000; border:none; cursor:pointer;
    box-shadow:0 10px 28px rgba(0,0,0,.35); font-weight:700;
  }
  #ttsFab:active{ transform:translateY(1px); }

  /* Panel */
  #ttsPanel{
    position:fixed; right:18px; bottom:84px; z-index:9999;
    width:320px; max-width:90vw;
    background:var(--paper, #29211e); color:var(--ink, #f3e6dd);
    border:1px solid #3a2f2b; border-radius:14px; overflow:hidden;
    box-shadow:0 12px 36px rgba(0,0,0,.4);
    display:none;
  }
  #ttsHead{
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 12px; background:linear-gradient(180deg,#2e2522,#231b18);
    border-bottom:1px solid #3a2f2b;
  }
  #ttsHead strong{ font-size:14px; letter-spacing:.3px; }
  #ttsClose{ background:none; border:none; color:inherit; font-size:18px; cursor:pointer; }

  #ttsBody{ padding:12px; display:grid; gap:10px; }
  #ttsControls{ display:flex; gap:8px; flex-wrap:wrap; }
  #ttsControls button{
    flex:1 1 auto; min-width:78px;
    padding:8px 10px; border-radius:10px; border:1px solid #4a3b35; background:#2d231f;
    color:inherit; cursor:pointer;
  }
  #ttsControls button:disabled{ opacity:.5; cursor:not-allowed; }
  #ttsRow{ display:grid; grid-template-columns:1fr 110px; gap:8px; }
  #ttsBody select, #ttsBody input[type="range"]{
    width:100%; background:#211a17; color:inherit; border:1px solid #4a3b35; border-radius:8px; padding:8px;
  }
  #ttsNote{
    font-size:12px; color:var(--muted,#c9b0a4); line-height:1.4;
    border-top:1px dashed #3a2f2b; padding-top:8px;
  }

  /* Sentence highlight */
  .tts-current{
    background:rgba(255,106,61,.22);
    box-shadow:0 0 0 2px rgba(255,106,61,.15) inset;
    border-radius:6px;
    transition:background .2s ease;
  }
</style>

<button id="ttsFab" aria-label="Listen">▶︎</button>

<div id="ttsPanel" role="dialog" aria-label="Text to Speech Reader">
  <div id="ttsHead">
    <strong>Reader — ❖ —</strong>
    <button id="ttsClose" aria-label="Close">×</button>
  </div>
  <div id="ttsBody">
    <div id="ttsRow">
      <select id="ttsVoice" aria-label="Voice"></select>
      <label style="display:flex;align-items:center;gap:8px;">
        <span style="font-size:12px;opacity:.85;white-space:nowrap;">Speed</span>
        <input id="ttsRate" type="range" min="0.7" max="1.4" step="0.05" value="1" />
      </label>
    </div>

    <div id="ttsControls">
      <button id="ttsPlay">Play</button>
      <button id="ttsPause" disabled>Pause</button>
      <button id="ttsStop" disabled>Stop</button>
      <button id="ttsPrev" disabled>◀︎ Prev</button>
      <button id="ttsNext" disabled>Next ▶︎</button>
    </div>

    <div style="display:flex;gap:8px;">
      <button id="ttsReadSel" style="flex:1;">Read Selection</button>
      <button id="ttsReadAll" style="flex:1;">Read All</button>
    </div>

    <div id="ttsNote">
      Tip: On iPhone/iPad, tap <em>Play</em> once to unlock audio (Safari requires a user gesture).
      The reader highlights each sentence as it speaks.
    </div>
  </div>
</div>

<script>
(function(){
  const area = document.querySelector('#readContent') || document.querySelector('main') || document.body;
  const synth = window.speechSynthesis;
  const supportsTTS = !!synth;

  const el = {
    fab: document.getElementById('ttsFab'),
    panel: document.getElementById('ttsPanel'),
    close: document.getElementById('ttsClose'),
    voice: document.getElementById('ttsVoice'),
    rate: document.getElementById('ttsRate'),
    play: document.getElementById('ttsPlay'),
    pause: document.getElementById('ttsPause'),
    stop: document.getElementById('ttsStop'),
    prev: document.getElementById('ttsPrev'),
    next: document.getElementById('ttsNext'),
    readSel: document.getElementById('ttsReadSel'),
    readAll: document.getElementById('ttsReadAll'),
  };

  if(!supportsTTS){
    el.fab.style.display='none';
    console.warn('Speech Synthesis not supported in this browser.');
    return;
  }

  // State
  let voices = [];
  let chunks = [];       // [{el:span, text:string}]
  let idx = -1;
  let speaking = false;
  let paused = false;
  let currentSelOnly = false;

  // ---- UI wiring
  el.fab.onclick = ()=> { el.panel.style.display = (el.panel.style.display==='block'?'none':'block'); };
  el.close.onclick = ()=> { el.panel.style.display='none'; };

  el.play.onclick = startOrResume;
  el.pause.onclick = pauseSpeech;
  el.stop.onclick = stopSpeech;
  el.prev.onclick = ()=> jump(-1);
  el.next.onclick = ()=> jump(+1);
  el.readSel.onclick = ()=> begin(true);
  el.readAll.onclick = ()=> begin(false);

  el.rate.oninput = ()=>{
    localStorage.setItem('ttsRate', el.rate.value);
    if(speaking && !paused){
      // rate applies to next utterance
    }
  };
  el.voice.onchange = ()=>{
    localStorage.setItem('ttsVoiceName', el.voice.value);
    // applies on next utterance
  };

  // Persisted settings
  const savedRate = localStorage.getItem('ttsRate');
  if(savedRate) el.rate.value = savedRate;

  // ---- Voice loading
  function loadVoices(){
    voices = synth.getVoices().sort((a,b)=> (a.lang||'').localeCompare(b.lang||'') || (a.name||'').localeCompare(b.name||''));
    el.voice.innerHTML = '';
    voices.forEach(v=>{
      const opt = document.createElement('option');
      opt.value = v.name;
      opt.textContent = `${v.name} — ${v.lang}`;
      el.voice.appendChild(opt);
    });
    // pick saved voice or a sensible default (en-PH or en-* or first)
    const saved = localStorage.getItem('ttsVoiceName');
    let def = voices.find(v=>v.name===saved)
           || voices.find(v=>/^en-PH/i.test(v.lang))
           || voices.find(v=>/^en-/i.test(v.lang))
           || voices[0];
    if(def){ el.voice.value = def.name; }
  }
  loadVoices();
  // some browsers fire this later
  if (typeof speechSynthesis !== 'undefined') {
    speechSynthesis.onvoiceschanged = loadVoices;
  }

  // ---- Prepare content into sentence spans
  function splitToSentences(root){
    // Clear previous wrapping
    root.querySelectorAll('span[data-tts]').forEach(s=>{
      const t = document.createTextNode(s.textContent);
      s.replaceWith(t);
    });

    const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
      acceptNode(node){
        const t = (node.nodeValue||'').replace(/\s+/g,' ');
        return t.trim() ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
      }
    });

    const nodes = [];
    while(walker.nextNode()) nodes.push(walker.currentNode);

    const sentenceEnd = /([^\s].*?[\.!\?…]+)(\s+|$)/g; // simple sentence chunker

    nodes.forEach(node=>{
      const text = node.nodeValue.replace(/\s+/g,' ');
      let lastIndex = 0;
      const frag = document.createDocumentFragment();
      let match;

      while ((match = sentenceEnd.exec(text)) !== null) {
        const before = text.slice(lastIndex, match.index);
        if(before.trim()){
          frag.appendChild(spanFor(before));
        }
        frag.appendChild(spanFor(match[1]));
        lastIndex = sentenceEnd.lastIndex;
      }
      const tail = text.slice(lastIndex);
      if(tail.trim()){
        frag.appendChild(spanFor(tail));
      }
      node.parentNode.replaceChild(frag, node);
    });

    function spanFor(t){
      const s = document.createElement('span');
      s.textContent = t.trim() + ' ';
      s.setAttribute('data-tts','1');
      return s;
    }
  }

  function harvestChunks(scope){
    chunks = Array.from(scope.querySelectorAll('span[data-tts]')).map(s=>({el:s, text:s.textContent.trim()}))
                   .filter(o=>o.text && o.text.length>0);
  }

  // ---- Reading flows
  function begin(selectionOnly){
    currentSelOnly = !!selectionOnly;
    const scope = selectionOnly && window.getSelection && !window.getSelection().isCollapsed
      ? rangeContainer(window.getSelection())
      : area;

    splitToSentences(scope);
    harvestChunks(scope);

    if(chunks.length===0){
      alert('No readable text found.');
      return;
    }
    idx = 0;
    speakCurrent();
    updateButtons();
  }

  function startOrResume(){
    if(!speaking){
      // if nothing queued, treat as "read selection" if user has one, else read all
      const hasSel = window.getSelection && !window.getSelection().isCollapsed;
      begin(hasSel);
      return;
    }
    if(paused){
      synth.resume();
      paused = false;
      updateButtons();
    }
  }

  function pauseSpeech(){
    if(speaking && !paused){
      synth.pause();
      paused = true;
      updateButtons();
    }
  }

  function stopSpeech(){
    synth.cancel();
    clearHighlight();
    speaking = false;
    paused = false;
    idx = -1;
    updateButtons();
  }

  function jump(delta){
    if(!speaking) return;
    synth.cancel();
    clearHighlight();
    idx = Math.max(0, Math.min(chunks.length-1, idx + delta));
    speakCurrent();
  }

  function speakCurrent(){
    if(idx<0 || idx>=chunks.length) { stopSpeech(); return; }

    const rate = parseFloat(el.rate.value || '1') || 1;
    const voice = voices.find(v=>v.name===el.voice.value) || null;

    const {el:node, text} = chunks[idx];
    clearHighlight();
    node.classList.add('tts-current');
    node.scrollIntoView({block:'center', behavior:'smooth'});

    const utt = new SpeechSynthesisUtterance(text);
    if(voice) utt.voice = voice;
    utt.rate = rate;

    utt.onend = ()=>{
      node.classList.remove('tts-current');
      idx++;
      if(idx < chunks.length){
        // slight gap to avoid overlap on some browsers
        setTimeout(speakCurrent, 60);
      }else{
        stopSpeech();
      }
    };
    utt.onerror = (e)=> {
      console.warn('TTS error:', e);
      stopSpeech();
    };

    speaking = true;
    paused = false;
    updateButtons();
    synth.speak(utt);
  }

  function clearHighlight(){
    document.querySelectorAll('.tts-current').forEach(n=> n.classList.remove('tts-current'));
  }

  function updateButtons(){
    el.play.disabled = speaking && !paused;   // playing -> disable Play
    el.pause.disabled = !speaking || paused;
    el.stop.disabled = !speaking;
    el.prev.disabled = !(speaking && idx>0);
    el.next.disabled = !(speaking && idx<chunks.length-1);
  }

  // Utility: get a Node that contains current selection (or area as fallback)
  function rangeContainer(sel){
    try{
      const range = sel.getRangeAt(0).cloneRange();
      // Create a wrapper around the selection to isolate splitting
      const wrapper = document.createElement('span');
      wrapper.setAttribute('data-tts-scope','1');
      range.surroundContents(wrapper);
      // Expand wrapper to parent block if selection is within one
      return wrapper;
    }catch(e){
      return area;
    }
  }

})();
</script>
<!-- ===== /Floating TTS Reader ===== -->
</body>
</html>
